<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Spring Boot</title>
    <link rel="stylesheet" href="http://bit.ly/3WJ5ilK">
</head>
<body>
	<!-- logout.html -->
	<header>
		<h1>Spring Security<small>JWT</small></h1>
		<ul>
			<li><a href="/">Home</a></li>
			<li><a href="/login.html">Login</a></li>
			<li><a href="/logout.html">Logout</a></li>
			<li><a href="/join.html">Join</a></li>
			<li><a href="/member.html">Member</a></li>
			<li><a href="/admin.html">Admin</a></li>
		</ul>
	</header>
	
	<h2>Logout</h2>
	<div>
		<button type="button" id="logout-button">로그아웃</button>
	</div>
		
	<script src="js/auth.js"></script>
	<script>
		
		document.getElementById('logout-button').addEventListener('click', async () => {

			//리프레시 토큰 삭제
			//- 서버측에 DB의 리프레시 토큰을 삭제하고 클라언트 쿠키를 만료시키라고 요청
			try {
				
				const response = await fetch('http://localhost:8080/logout', {
					method: 'POST',
					credentials: 'include' //HttpOnly 쿠키 전송
				});
				
				if (response.ok) {
					console.log('로그 아웃 성공');
				} else {
					console.log('로그아웃 요청 실패 or 리프레시 토큰 이미 만료됨');
				}
				
			} catch (e) {
				console.log(e);
			}
			

			//액세스 토큰 삭제
			sessionStorage.removeItem('accessToken');
			sessionStorage.removeItem('username');
			window.location.href = 'index.html';
		});
		
	</script>
</body>
</html>